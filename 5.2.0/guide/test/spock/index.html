



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Dropwizard guice integration">
      
      
        <link rel="canonical" href="https://xvik.github.io/dropwizard-guicey/5.2.0/guide/test/spock/">
      
      
        <meta name="author" content="Vyacheslav Rusakov">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>Spock - Dropwizard-guicey</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-93174150-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#spock" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://xvik.github.io/dropwizard-guicey/5.2.0" title="Dropwizard-guicey" aria-label="Dropwizard-guicey" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Dropwizard-guicey
            </span>
            <span class="md-header-nav__topic">
              
                Spock
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/xvik/dropwizard-guicey/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    dropwizard-guicey
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../.." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
      
        
      
        
      
        
      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../configuration/" class="md-tabs__link md-tabs__link--active">
          User guide
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../installers/resource/" class="md-tabs__link">
          Installers
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../extras/bom/" class="md-tabs__link">
          Modules
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../examples/authentication/" class="md-tabs__link">
          Examples
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../about/release-notes/" class="md-tabs__link">
          About
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://xvik.github.io/dropwizard-guicey/5.2.0" title="Dropwizard-guicey" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Dropwizard-guicey
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/xvik/dropwizard-guicey/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    dropwizard-guicey
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../getting-started/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../concepts/" title="Concepts overview" class="md-nav__link">
      Concepts overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../guice/" title="Guice" class="md-nav__link">
      Guice
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../tests/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../decomposition/" title="Decomposition" class="md-nav__link">
      Decomposition
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      User guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        User guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../web/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../modules/" title="Extra integrations" class="md-nav__link">
      Extra integrations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bundles/" title="Bundles" class="md-nav__link">
      Bundles
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../yaml-values/" title="Yaml values" class="md-nav__link">
      Yaml values
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-7" type="checkbox" id="nav-7-7">
    
    <label class="md-nav__link" for="nav-7-7">
      Guice
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-7">
        Guice
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../guice/injector/" title="Injector" class="md-nav__link">
      Injector
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guice/bindings/" title="Bindings" class="md-nav__link">
      Bindings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guice/scopes/" title="Scopes" class="md-nav__link">
      Scopes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guice/module-autowiring/" title="Module autowiring" class="md-nav__link">
      Module autowiring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guice/module-analysis/" title="Modules analysis" class="md-nav__link">
      Modules analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guice/override/" title="Override bindings" class="md-nav__link">
      Override bindings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guice/servletmodule/" title="ServletModule" class="md-nav__link">
      ServletModule
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-8" type="checkbox" id="nav-7-8">
    
    <label class="md-nav__link" for="nav-7-8">
      Diagnostic
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-8">
        Diagnostic
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../diagnostic/diagnostic-tools/" title="Tools" class="md-nav__link">
      Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../diagnostic/configuration-report/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../diagnostic/configuration-model/" title="Configuration model" class="md-nav__link">
      Configuration model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../diagnostic/installers-report/" title="Installers" class="md-nav__link">
      Installers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../diagnostic/yaml-values-report/" title="Yaml values" class="md-nav__link">
      Yaml values
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../diagnostic/lifecycle-report/" title="Lifecycle" class="md-nav__link">
      Lifecycle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../diagnostic/guice-report/" title="Guice" class="md-nav__link">
      Guice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../diagnostic/aop-report/" title="AOP" class="md-nav__link">
      AOP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../diagnostic/web-report/" title="Web" class="md-nav__link">
      Web
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../diagnostic/jersey-report/" title="Jersey" class="md-nav__link">
      Jersey
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-9" type="checkbox" id="nav-7-9" checked>
    
    <label class="md-nav__link" for="nav-7-9">
      Test
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-9">
        Test
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../junit5/" title="Junit 5" class="md-nav__link">
      Junit 5
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Spock
      </label>
    
    <a href="./" title="Spock" class="md-nav__link md-nav__link--active">
      Spock
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#extensions" class="md-nav__link">
    Extensions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useguiceyapp" class="md-nav__link">
    @UseGuiceyApp
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usedropwizardapp" class="md-nav__link">
    @UseDropwizardApp
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#random-ports" class="md-nav__link">
    Random ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rest-mapping" class="md-nav__link">
    Rest mapping
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#guice-injections" class="md-nav__link">
    Guice injections
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client" class="md-nav__link">
    Client
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-test-modification" class="md-nav__link">
    Application test modification
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hook-fields" class="md-nav__link">
    Hook fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hooks-extension" class="md-nav__link">
    Hooks extension
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dropwizard-startup-error" class="md-nav__link">
    Dropwizard startup error
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spock-lifecycle-hooks" class="md-nav__link">
    Spock lifecycle hooks
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../junit4/" title="Junit 4" class="md-nav__link">
      Junit 4
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lifecycle/" title="Lifecycle" class="md-nav__link">
      Lifecycle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../scan/" title="Classpath scan" class="md-nav__link">
      Classpath scan
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installers/" title="Installers" class="md-nav__link">
      Installers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ordering/" title="Ordering" class="md-nav__link">
      Ordering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/" title="Options" class="md-nav__link">
      Options
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../events/" title="Events" class="md-nav__link">
      Events
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../disables/" title="Disables" class="md-nav__link">
      Disables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deduplication/" title="De-duplication" class="md-nav__link">
      De-duplication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../commands/" title="Commands" class="md-nav__link">
      Commands
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hooks/" title="Hooks" class="md-nav__link">
      Hooks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../shared/" title="Shared state" class="md-nav__link">
      Shared state
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../hk2/" title="HK2" class="md-nav__link">
      HK2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Installers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Installers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installers/resource/" title="Resource" class="md-nav__link">
      Resource
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installers/task/" title="Task" class="md-nav__link">
      Task
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installers/managed/" title="Managed" class="md-nav__link">
      Managed
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installers/lifecycle/" title="Lifecycle" class="md-nav__link">
      Lifecycle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installers/healthcheck/" title="Health check" class="md-nav__link">
      Health check
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installers/jersey-ext/" title="Jersey extension" class="md-nav__link">
      Jersey extension
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installers/jersey-feature/" title="Jersey feature" class="md-nav__link">
      Jersey feature
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installers/eager/" title="Eager singleton" class="md-nav__link">
      Eager singleton
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installers/plugin/" title="Plugin" class="md-nav__link">
      Plugin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installers/servlet/" title="Web servlet" class="md-nav__link">
      Web servlet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installers/filter/" title="Web filter" class="md-nav__link">
      Web filter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../installers/listener/" title="Web listener" class="md-nav__link">
      Web listener
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Modules
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Modules
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extras/bom/" title="BOM" class="md-nav__link">
      BOM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extras/admin-rest/" title="Admin REST" class="md-nav__link">
      Admin REST
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extras/lifecycle-annotations/" title="Lifecycle annotations" class="md-nav__link">
      Lifecycle annotations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extras/eventbus/" title="Guava EventBus" class="md-nav__link">
      Guava EventBus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extras/jdbi/" title="JDBI" class="md-nav__link">
      JDBI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extras/jdbi3/" title="JDBI3" class="md-nav__link">
      JDBI3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extras/spa/" title="SPA" class="md-nav__link">
      SPA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extras/gsp/" title="Server Pages" class="md-nav__link">
      Server Pages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extras/validation/" title="Validation" class="md-nav__link">
      Validation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Examples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/authentication/" title="Authentication" class="md-nav__link">
      Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/governator/" title="Governator" class="md-nav__link">
      Governator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/hibernate/" title="Hibernate" class="md-nav__link">
      Hibernate
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/eventbus/" title="EventBus" class="md-nav__link">
      EventBus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/jdbi/" title="JDBI" class="md-nav__link">
      JDBI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/jdbi3/" title="JDBI3" class="md-nav__link">
      JDBI3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../about/release-notes/" title="Release notes" class="md-nav__link">
      Release notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../about/compatibility/" title="Compatibility" class="md-nav__link">
      Compatibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../about/history/" title="Version history" class="md-nav__link">
      Version history
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../about/support/" title="Support" class="md-nav__link">
      Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../about/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#extensions" class="md-nav__link">
    Extensions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useguiceyapp" class="md-nav__link">
    @UseGuiceyApp
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usedropwizardapp" class="md-nav__link">
    @UseDropwizardApp
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#random-ports" class="md-nav__link">
    Random ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rest-mapping" class="md-nav__link">
    Rest mapping
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#guice-injections" class="md-nav__link">
    Guice injections
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client" class="md-nav__link">
    Client
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-test-modification" class="md-nav__link">
    Application test modification
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hook-fields" class="md-nav__link">
    Hook fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hooks-extension" class="md-nav__link">
    Hooks extension
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dropwizard-startup-error" class="md-nav__link">
    Dropwizard startup error
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spock-lifecycle-hooks" class="md-nav__link">
    Spock lifecycle hooks
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/xvik/dropwizard-guicey/edit/master/src/doc/docs/guide/test/spock.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="spock">Spock<a class="headerlink" href="#spock" title="Permanent link">&para;</a></h1>
<p><a href="http://spockframework.org">Spock framework</a> allows you to write much clearer tests (comparing to junit) thanks to 
groovy language.</p>
<p>You will need the following dependencies (assuming BOM used for versions management):</p>
<div class="codehilite"><pre><span></span><code><span class="n">testImplementation</span> <span class="s1">&#39;io.dropwizard:dropwizard-testing&#39;</span>

<span class="n">testImplementation</span> <span class="s1">&#39;org.objenesis:objenesis:3.1&#39;</span>
<span class="n">testImplementation</span> <span class="s1">&#39;cglib:cglib-nodep:3.3.0&#39;</span>
<span class="n">testImplementation</span> <span class="s1">&#39;org.spockframework:spock-core&#39;</span>
</code></pre></div>

<p>OR you can use it with junit 5 vintage engine:</p>
<div class="codehilite"><pre><span></span><code><span class="n">testImplementation</span> <span class="s1">&#39;io.dropwizard:dropwizard-testing&#39;</span>

<span class="n">testImplementation</span> <span class="s1">&#39;org.objenesis:objenesis:3.1&#39;</span>
<span class="n">testImplementation</span> <span class="s1">&#39;cglib:cglib-nodep:3.3.0&#39;</span>
<span class="n">testImplementation</span> <span class="s1">&#39;org.spockframework:spock-core&#39;</span>

<span class="n">testImplementation</span> <span class="s1">&#39;org.junit.jupiter:junit-jupiter-api&#39;</span>
<span class="n">testRuntimeOnly</span> <span class="s1">&#39;org.junit.jupiter:junit-jupiter&#39;</span>
<span class="n">testRuntimeOnly</span> <span class="s1">&#39;org.junit.vintage:junit-vintage-engine&#39;</span>
</code></pre></div>

<p>This way you can write both spock (groovy) and junit 5 (java or groovy) tests.</p>
<h2 id="extensions">Extensions<a class="headerlink" href="#extensions" title="Permanent link">&para;</a></h2>
<p>Provided extensions:</p>
<ul>
<li><code>@UseGuiceyApp</code> - for lightweight tests (without starting web part, only guice context)</li>
<li><code>@UseDropwizardApp</code> - for complete integration tests</li>
</ul>
<p>Both extensions allow using injections directly in specifications (like spock-guice).</p>
<p><code>@UseGuiceyHooks</code> extension could be used to apply <a href="../../hooks/">configuration hook</a> 
common for all tests. But, it is deprecated in favor of native hooks support in main extensions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Spock and junit5 extensions are almost equivalent in features and behaviour. Differences:</p>
<ul>
<li>Obviously different extension annotations, but completely the same attributes and behaviour</li>
<li>Spock does not support test method parameters injections, so everything injected with fields
  (including <a href="#client">ClientSupport</a> object).  </li>
<li>Config override syntax (spock extension use legacy syntax, which will change in the next breaking release)</li>
</ul>
</div>
<h2 id="useguiceyapp">@UseGuiceyApp<a class="headerlink" href="#useguiceyapp" title="Permanent link">&para;</a></h2>
<p><code>@UseGuiceyApp</code> runs all guice logic without starting jetty (so resources, servlets and filters will not be available).
<code>Managed</code> objects will still be handled correctly.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@UseGuiceyApp</span><span class="o">(</span><span class="n">MyApplication</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">AutoScanModeTest</span> <span class="kd">extends</span> <span class="n">Specification</span> <span class="o">{</span>

    <span class="nd">@Inject</span> <span class="n">MyService</span> <span class="n">service</span>

    <span class="kt">def</span> <span class="s2">&quot;My service test&quot;</span> <span class="o">{</span>

        <span class="nl">when:</span> <span class="s1">&#39;calling service&#39;</span>
        <span class="kt">def</span> <span class="n">res</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">getSmth</span><span class="o">()</span>

        <span class="nl">then:</span> <span class="s1">&#39;correct result returned&#39;</span>
        <span class="n">res</span> <span class="o">==</span> <span class="s1">&#39;hello&#39;</span>
    <span class="o">}</span>
</code></pre></div>

<p>Application started before all tests in annotated class and stopped after them.</p>
<h2 id="usedropwizardapp">@UseDropwizardApp<a class="headerlink" href="#usedropwizardapp" title="Permanent link">&para;</a></h2>
<p><code>@UseDropwizardApp</code> is useful for complete integration testing (when web part is required):</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@UseDropwizardApp</span><span class="o">(</span><span class="n">MyApplication</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">WebModuleTest</span> <span class="kd">extends</span> <span class="n">Specification</span> <span class="o">{</span>

    <span class="nd">@Inject</span> <span class="n">MyService</span> <span class="n">service</span>

    <span class="kt">def</span> <span class="s2">&quot;Check web bindings&quot;</span><span class="o">()</span> <span class="o">{</span>

        <span class="nl">when:</span> <span class="s2">&quot;calling filter&quot;</span>
        <span class="kt">def</span> <span class="n">res</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s2">&quot;http://localhost:8080/dummyFilter&quot;</span><span class="o">).</span><span class="na">getText</span><span class="o">()</span>

        <span class="nl">then:</span> <span class="s2">&quot;filter active&quot;</span>
        <span class="n">res</span> <span class="o">==</span> <span class="s1">&#39;Sample filter and service called&#39;</span>
        <span class="n">service</span><span class="o">.</span><span class="na">isCalled</span><span class="o">()</span>
</code></pre></div>

<h3 id="random-ports">Random ports<a class="headerlink" href="#random-ports" title="Permanent link">&para;</a></h3>
<p>In order to start application on random port you can use configuration shortcut:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@UseDropwizardApp</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">MyApplication</span><span class="o">,</span> <span class="n">randomPorts</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Random ports will be applied even if configuration with exact ports provided:
<div class="codehilite"><pre><span></span><code><span class="nd">@UseDropwizardApp</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">MyApplication</span><span class="o">,</span> 
                  <span class="n">config</span> <span class="o">=</span> <span class="s1">&#39;path/to/my/config.yml&#39;</span><span class="o">,</span> 
                  <span class="n">randomPorts</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
</code></pre></div>
Also, random ports support both server types (default and simple)</p>
</div>
<p>Real ports could be resolved with <a href="#client">ClientSupport</a> object.</p>
<h3 id="rest-mapping">Rest mapping<a class="headerlink" href="#rest-mapping" title="Permanent link">&para;</a></h3>
<p>Normally, rest mapping configured with <code>server.rootMapping=/something/*</code> configuration, but
if you don't use custom configuration class, but still want to re-map rest, shortcut could be used:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@UseDropwizardApp</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">MyApplication</span><span class="o">,</span> <span class="n">restMapping</span><span class="o">=</span><span class="s2">&quot;something&quot;</span><span class="o">)</span>
</code></pre></div>

<p>In contrast to config declaration, attribute value may not start with '/' and end with '/*' -
it would be appended automatically. </p>
<p>This option is only intended to simplify cases when custom configuration file is not yet used in tests
(usually early PoC phase). It allows you to map servlet into application root in test (because rest is no
more resides in root). When used with existing configuration file, this parameter will override file definition.</p>
<h2 id="guice-injections">Guice injections<a class="headerlink" href="#guice-injections" title="Permanent link">&para;</a></h2>
<p>Any gucie bean may be injected directly into test field:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@Inject</span>
<span class="n">SomeBean</span> <span class="n">bean</span>
</code></pre></div>

<p>This may be even bean not declared in guice modules (JIT injection will occur).</p>
<p>To better understand injection scopes look the following test:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@UseGuiceyApp</span><span class="o">(</span><span class="n">AutoScanApplication</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">InjectionTest</span> <span class="kd">extends</span> <span class="n">Specification</span> <span class="o">{</span>

    <span class="c1">// instance remain the same between tests</span>
    <span class="nd">@Shared</span> <span class="nd">@Inject</span> <span class="n">TestBean</span> <span class="n">sharedBean</span>

    <span class="c1">// new instance injected on each test</span>
    <span class="nd">@Inject</span> <span class="n">TestBean</span> <span class="n">bean</span>

    <span class="c1">// the same context used for all tests (in class), so the same bean instance inserted before each test</span>
    <span class="nd">@Inject</span> <span class="n">TestSingletonBean</span> <span class="n">singletonBean</span>

    <span class="kt">def</span> <span class="s2">&quot;Check injection types&quot;</span><span class="o">()</span> <span class="o">{</span>
        <span class="nl">when:</span> <span class="s2">&quot;changing state of injected beans&quot;</span>
        <span class="n">sharedBean</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">bean</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">singletonBean</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="mi">15</span>

        <span class="nl">then:</span> <span class="s2">&quot;instances are different&quot;</span>
        <span class="n">sharedBean</span><span class="o">.</span><span class="na">value</span> <span class="o">==</span> <span class="mi">10</span>
        <span class="n">bean</span><span class="o">.</span><span class="na">value</span> <span class="o">==</span> <span class="mi">5</span>
        <span class="n">singletonBean</span><span class="o">.</span><span class="na">value</span> <span class="o">==</span> <span class="mi">15</span>

    <span class="o">}</span>

    <span class="kt">def</span> <span class="s2">&quot;Check shared state&quot;</span><span class="o">()</span> <span class="o">{</span>

        <span class="nl">expect:</span> <span class="s2">&quot;shared bean instance is the same, whereas other one re-injected&quot;</span>
        <span class="n">sharedBean</span><span class="o">.</span><span class="na">value</span> <span class="o">==</span> <span class="mi">10</span>
        <span class="n">bean</span><span class="o">.</span><span class="na">value</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">singletonBean</span><span class="o">.</span><span class="na">value</span> <span class="o">==</span> <span class="mi">15</span> <span class="c1">// the same instance was set before second test</span>
    <span class="o">}</span>

    <span class="c1">// bean is in prototype scope</span>
    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">TestBean</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">value</span>
    <span class="o">}</span>

    <span class="nd">@Singleton</span>
    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">TestSingletonBean</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">value</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Guice AOP will not work on test methods (because test instances not created by guice).</p>
</div>
<h2 id="client">Client<a class="headerlink" href="#client" title="Permanent link">&para;</a></h2>
<p>Both extensions prepare special jersey client instance which could be used for web calls.
It is mostly useful for complete web tests to call rest services and servlets.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@InjectClient</span>
<span class="n">ClientSupport</span> <span class="n">client</span>
</code></pre></div>

<p>It will also work in static fields or <code>@Shared</code> fields.</p>
<p>Client object provides:</p>
<ul>
<li>Access to <a href="https://eclipse-ee4j.github.io/jersey.github.io/documentation/2.29.1/client.html">JerseyClient</a> object (for raw calls)</li>
<li>Shortcuts for querying main, admin or rest contexts (it will count the current configuration automatically)</li>
<li>Shortcuts for base main, admin or rest contexts base urls (and application ports)</li>
</ul>
<p>Example usages:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// GET {rest path}/some</span>
<span class="n">client</span><span class="o">.</span><span class="na">targetRest</span><span class="o">(</span><span class="s2">&quot;some&quot;</span><span class="o">).</span><span class="na">request</span><span class="o">().</span><span class="na">buildGet</span><span class="o">().</span><span class="na">invoke</span><span class="o">()</span>

<span class="c1">// GET {main context path}/servlet</span>
<span class="n">client</span><span class="o">.</span><span class="na">targetMain</span><span class="o">(</span><span class="s2">&quot;servlet&quot;</span><span class="o">).</span><span class="na">request</span><span class="o">().</span><span class="na">buildGet</span><span class="o">().</span><span class="na">invoke</span><span class="o">()</span>

<span class="c1">// GET {admin context path}/adminServlet</span>
<span class="n">client</span><span class="o">.</span><span class="na">targetAdmin</span><span class="o">(</span><span class="s2">&quot;adminServlet&quot;</span><span class="o">).</span><span class="na">request</span><span class="o">().</span><span class="na">buildGet</span><span class="o">().</span><span class="na">invoke</span><span class="o">()</span>
</code></pre></div>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>All methods above accepts any number of strings which would be automatically combined into correct path:
<div class="codehilite"><pre><span></span><code><span class="n">client</span><span class="o">.</span><span class="na">targetRest</span><span class="o">(</span><span class="s2">&quot;some&quot;</span><span class="o">,</span> <span class="s2">&quot;other/&quot;</span><span class="o">,</span> <span class="s2">&quot;/part&quot;</span><span class="o">)</span>
</code></pre></div>
would be correctly combined as "/some/other/part/"</p>
</div>
<p>As you can see test code is abstracted from actual configuration: it may be default or simple server
with any contexts mapping on any ports - target urls will always be correct.</p>
<div class="codehilite"><pre><span></span><code><span class="nl">when:</span> <span class="s2">&quot;calling rest service&quot;</span>
<span class="kt">def</span> <span class="n">res</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">targetRest</span><span class="o">(</span><span class="s2">&quot;some&quot;</span><span class="o">).</span><span class="na">request</span><span class="o">().</span><span class="na">buildGet</span><span class="o">().</span><span class="na">invoke</span><span class="o">()</span>

<span class="nl">then:</span> <span class="s2">&quot;response is correct&quot;</span>
<span class="n">res</span><span class="o">.</span><span class="na">status</span> <span class="o">==</span> <span class="mi">200</span>
<span class="n">res</span><span class="o">.</span><span class="na">readEntity</span><span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="o">==</span> <span class="s2">&quot;response text&quot;</span>
</code></pre></div>

<p>Also, if you want to use other client, client object can simply provide required info:</p>
<div class="codehilite"><pre><span></span><code><span class="n">client</span><span class="o">.</span><span class="na">getPort</span><span class="o">()</span>        <span class="c1">// app port (8080)</span>
<span class="n">client</span><span class="o">.</span><span class="na">getAdminPort</span><span class="o">()</span>   <span class="c1">// app admin port (8081)</span>
<span class="n">client</span><span class="o">.</span><span class="na">basePathMain</span><span class="o">()</span>   <span class="c1">// main context path (http://localhost:8080/)</span>
<span class="n">client</span><span class="o">.</span><span class="na">basePathAdmin</span><span class="o">()</span>  <span class="c1">// admin context path (http://localhost:8081/)</span>
<span class="n">client</span><span class="o">.</span><span class="na">basePathRest</span><span class="o">()</span>   <span class="c1">// rest context path (http://localhost:8080/)</span>
</code></pre></div>

<p>Raw client usage:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// call completely external url</span>
<span class="n">client</span><span class="o">.</span><span class="na">target</span><span class="o">(</span><span class="s2">&quot;http://somedomain:8080/dummy/&quot;</span><span class="o">).</span><span class="na">request</span><span class="o">().</span><span class="na">buildGet</span><span class="o">().</span><span class="na">invoke</span><span class="o">()</span>
</code></pre></div>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Client object could be injected with both dropwizard and guicey extensions, but in case of guicey extension,
only raw client could be used (because web part not started all other methods will throw NPE)</p>
</div>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>For both extensions you can configure application with external configuration file:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@UseGuiceyApp</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">MyApplication</span><span class="o">,</span>
    <span class="n">config</span> <span class="o">=</span> <span class="s1">&#39;path/to/my/config.yml&#39;</span>
<span class="kd">class</span> <span class="nc">ConfigOverrideTest</span> <span class="kd">extends</span> <span class="n">Specification</span> <span class="o">{</span>
</code></pre></div>

<p>Or just declare required values:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@UseGuiceyApp</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">MyApplication</span><span class="o">,</span>
    <span class="n">configOverride</span> <span class="o">=</span> <span class="o">[</span>
            <span class="nd">@ConfigOverride</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span><span class="o">),</span>
            <span class="nd">@ConfigOverride</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;bar&quot;</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;12&quot;</span><span class="o">)</span>
    <span class="o">])</span>
<span class="kd">class</span> <span class="nc">ConfigOverrideTest</span> <span class="kd">extends</span> <span class="n">Specification</span> <span class="o">{</span>
</code></pre></div>

<p>Or use both at once (here overrides will override file values):</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@UseGuiceyApp</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">MyApplication</span><span class="o">,</span>
    <span class="n">config</span> <span class="o">=</span> <span class="s1">&#39;path/to/my/config.yml&#39;</span><span class="o">,</span>
    <span class="n">configOverride</span> <span class="o">=</span> <span class="o">[</span>
            <span class="nd">@ConfigOverride</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span><span class="o">),</span>
            <span class="nd">@ConfigOverride</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;bar&quot;</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;12&quot;</span><span class="o">)</span>
    <span class="o">])</span>
<span class="kd">class</span> <span class="nc">ConfigOverrideTest</span> <span class="kd">extends</span> <span class="n">Specification</span> <span class="o">{</span>
</code></pre></div>

<h2 id="application-test-modification">Application test modification<a class="headerlink" href="#application-test-modification" title="Permanent link">&para;</a></h2>
<p>You can use <a href="../overview/#configuration-hooks">hooks to customize application</a>.</p>
<p>In both extensions annotation hooks could be declared with attribute:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@UseDropwizardApp</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">MyApplication</span><span class="p">,</span> <span class="n">hooks</span> <span class="o">=</span> <span class="n">MyHook</span><span class="p">)</span>
</code></pre></div>

<p>or</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@UseGuiceyApp</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">MyApplication</span><span class="p">,</span> <span class="n">hooks</span> <span class="o">=</span> <span class="n">MyHook</span><span class="p">)</span>
</code></pre></div>

<p>Where MyHook is:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">MyHook</span> <span class="kd">implements</span> <span class="n">GuiceyConfigurationHook</span> <span class="p">{}</span>
</code></pre></div>

<h3 id="hook-fields">Hook fields<a class="headerlink" href="#hook-fields" title="Permanent link">&para;</a></h3>
<p>Alternatively, you can declare hook directly in test static field:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@EnableHook</span>
<span class="kd">static</span> <span class="n">GuiceyConfigurationHook</span> <span class="n">HOOK</span> <span class="o">=</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">modules</span><span class="o">(</span><span class="k">new</span> <span class="n">DebugModule</span><span class="o">())</span> <span class="o">}</span>
</code></pre></div>

<p>Any number of fields could be declared. The same way hook could be declared in base test class:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">BaseTest</span> <span class="kd">extends</span> <span class="n">Specification</span> <span class="o">{</span>

    <span class="c1">// hook in base class</span>
    <span class="nd">@EnableHook</span>
    <span class="kd">static</span> <span class="n">GuiceyConfigurationHook</span> <span class="n">BASE_HOOK</span> <span class="o">=</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">modules</span><span class="o">(</span><span class="k">new</span> <span class="n">DebugModule</span><span class="o">())</span> <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@UseGuiceyApp</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">App</span><span class="o">,</span> <span class="n">hooks</span> <span class="o">=</span> <span class="n">SomeOtherHook</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">SomeTest</span> <span class="kd">extends</span> <span class="n">BaseTest</span> <span class="o">{</span>

    <span class="c1">// Another hook</span>
    <span class="nd">@EnableHook</span>
    <span class="kd">static</span> <span class="n">GuiceyConfigurationHook</span> <span class="n">HOOK</span> <span class="o">=</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">modules</span><span class="o">(</span><span class="k">new</span> <span class="n">DebugModule2</span><span class="o">())</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>

<p>All 3 hooks will work.</p>
<h3 id="hooks-extension">Hooks extension<a class="headerlink" href="#hooks-extension" title="Permanent link">&para;</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This extension is deprecated in favour of field hooks declarations. </p>
</div>
<div class="codehilite"><pre><span></span><code><span class="nd">@UseGuiceyHooks</span><span class="o">(</span><span class="n">MyBaseHook</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">BaseTest</span> <span class="kd">extends</span> <span class="n">Specification</span> <span class="o">{</span>

<span class="o">}</span>

<span class="nd">@UseGuiceyApp</span><span class="o">(</span><span class="n">App</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">SomeTest</span> <span class="kd">extends</span> <span class="n">BaseTest</span> <span class="o">{}</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You <strong>can still use</strong> test specific hooks together with declared base hook
(to apply some more test-specific configuration).</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Only one <code>@UseGuiceyHooks</code> declaration may be used in test hierarchy:
for example, you can't declare it in base class and then another one on extended class
- base for a group of tests. This is spock limitation (only one extension will actually work)
but should not be an issue for most cases.</p>
</div>
<h2 id="dropwizard-startup-error">Dropwizard startup error<a class="headerlink" href="#dropwizard-startup-error" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>StartupErrorRule is deprecated, but as spock still depends on junit4 (waiting for spock2)
there are no alternatives.   </p>
</div>
<p><code>StartupErrorRule</code> may be used to intercept dropwizard <code class="codehilite"><span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></code> call.
But it will work different then for junit:
<code>then</code> section is always called with exception (<code>CheckExitCalled</code>). 
Also, <code>then</code> section may be used for assertion after exit calls and so there is 
no need to add custom assertion callbacks (required by junit tests).</p>
<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">ErrorTest</span> <span class="kd">extends</span> <span class="n">Specification</span> <span class="o">{</span>

    <span class="nd">@Rule</span> <span class="n">StartupErrorRule</span> <span class="n">RULE</span> <span class="o">=</span> <span class="n">StartupErrorRule</span><span class="o">.</span><span class="na">create</span><span class="o">()</span>

    <span class="kt">def</span> <span class="s2">&quot;Check startup error&quot;</span><span class="o">()</span> <span class="o">{</span>

        <span class="nl">when:</span> <span class="s2">&quot;starting app with error&quot;</span>
        <span class="k">new</span> <span class="nf">MyErrApp</span><span class="o">().</span><span class="na">main</span><span class="o">([</span><span class="s1">&#39;server&#39;</span><span class="o">])</span>

        <span class="nl">then:</span> <span class="s2">&quot;startup failed&quot;</span>
        <span class="n">thrown</span><span class="o">(</span><span class="n">RULE</span><span class="o">.</span><span class="na">indicatorExceptionType</span><span class="o">)</span>
        <span class="n">RULE</span><span class="o">.</span><span class="na">output</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s1">&#39;stating application&#39;</span><span class="o">)</span>
        <span class="n">RULE</span><span class="o">.</span><span class="na">error</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s1">&#39;some error occur&#39;</span><span class="o">)</span>
</code></pre></div>

<h2 id="spock-lifecycle-hooks">Spock lifecycle hooks<a class="headerlink" href="#spock-lifecycle-hooks" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="kd">class</span> <span class="nc">MyTest</span> <span class="kd">extends</span> <span class="n">Specification</span> <span class="o">{</span>

    <span class="nd">@ClassRule</span> <span class="nd">@Shared</span>
    <span class="n">JunitRule</span> <span class="n">sharedRule</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JunitRule</span><span class="o">()</span>

    <span class="nd">@Rule</span>
    <span class="n">JunitRule2</span> <span class="n">rule</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JunitRule2</span><span class="o">()</span>

    <span class="kt">def</span> <span class="nf">setupSpec</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="s2">&quot;Test method body&quot;</span> <span class="o">()</span> <span class="o">{</span>
        <span class="nl">setup:</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>

<div class="admonition note">
<p>Class rules are applied once per test class (same as <code>setupSpec</code>).
Rules are applied per test method (same as <code>setup</code>).</p>
</div>
<p>Setup order:</p>
<ul>
<li>Class rule</li>
<li>Setup spec method</li>
<li>Rule</li>
<li>Setup method</li>
<li>Test method's setup section</li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../junit5/" title="Junit 5" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Junit 5
              </span>
            </div>
          </a>
        
        
          <a href="../junit4/" title="Junit 4" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Junit 4
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2014-2020 Vyacheslav Rusakov
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/xvik" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/vyarus" target="_blank" rel="noopener" title="twitter" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:"../../.."}})</script>
      
    
  </body>
</html>